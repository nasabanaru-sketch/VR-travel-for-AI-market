<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Trip Experience</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  </head>
  <body>
    <script>
      // VR旅行のロジックを管理するコンポーネント
      AFRAME.registerComponent('trip-manager', {
        init: function () {
          this.sky = document.querySelector('#main-sky');
          this.menu = document.querySelector('#menu-container');
          this.fader = document.querySelector('#fader');
          this.isTraveling = false;

          // メニューボタンにイベントリスナーを追加
          const buttons = document.querySelectorAll('.trip-btn');
          buttons.forEach((btn, index) => {
            btn.addEventListener('click', () => {
              if (this.isTraveling) return; // 旅行中はクリック無効
              const imageId = `#img${index + 1}`;
              this.startTrip(imageId);
            });
          });
        },

        startTrip: function (imageId) {
          this.isTraveling = true;

          // 1. 3秒かけてホワイトアウト（白くなる）
          this.fader.emit('fade-white');

          // 2. 画面が真っ白になったタイミング（3秒後）で画像を切り替え & メニューを隠す
          setTimeout(() => {
            this.sky.setAttribute('src', imageId);
            this.menu.setAttribute('visible', 'false');
            
            // 3. 3秒かけてフェードイン（景色が見えてくる）
            this.fader.emit('fade-clear');
            
            // 4. 1分後にメニューに戻る処理を開始
            this.scheduleReturn();
          }, 3000);
        },

        scheduleReturn: function () {
          // 1分間待機
          setTimeout(() => {
            // 戻るためのホワイトアウト開始
            this.fader.emit('fade-white');

            // 3秒後にメニュー画面に戻す
            setTimeout(() => {
              this.sky.setAttribute('src', '#img-default');
              this.menu.setAttribute('visible', 'true');
              
              // フェードイン（メニューが見えてくる）
              this.fader.emit('fade-clear');
              this.isTraveling = false;
            }, 3000);

          }, 60000); // 60000ms = 1分
        }
      });
    </script>

    <a-scene trip-manager background="color: #ECECEC">
      
      <a-assets>
        <img id="img-default" src="" crossorigin="anonymous"> 
        
        <img id="img1" src="Skya-image1.jpg" crossorigin="anonymous">
        <img id="img2" src="Skya-image2.jpg" crossorigin="anonymous">
        <img id="img3" src="Skya-image3.jpg" crossorigin="anonymous">
        <img id="img4" src="Skya-image4.jpg" crossorigin="anonymous">
      </a-assets>

      <a-sky id="main-sky" src="#img-default"></a-sky>

      <a-entity position="0 1.6 0">
        <a-camera look-controls="pointerLockEnabled: false">
          <a-sphere id="fader" radius="0.2" material="shader: flat; color: white; side: back; transparent: true; opacity: 0"
            animation__white="property: material.opacity; to: 1; dur: 3000; startEvents: fade-white; easing: linear"
            animation__clear="property: material.opacity; to: 0; dur: 3000; startEvents: fade-clear; easing: linear">
          </a-sphere>
          
          <a-cursor
            color="black"
            fuse="true"
            fuse-timeout="1500"
            raycaster="objects: .clickable"
            scale="0.5 0.5 0.5"
            animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 0.5 0.5 0.5"
            animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 0.5 0.5 0.5; to: 0.1 0.1 0.1"
            visible="false">
          </a-cursor>
        </a-camera>
        
        <a-entity laser-controls="hand: left" raycaster="objects: .clickable; far: 10"></a-entity>
        <a-entity laser-controls="hand: right" raycaster="objects: .clickable; far: 10"></a-entity>
      </a-entity>

      <a-entity id="menu-container" position="0 1.6 -3">
        
        <a-text value="Select Your Destination" align="center" position="0 1.2 0" color="#FFF" scale="1.5 1.5 1.5"></a-text>

        <a-entity position="-1.65 0 0" class="trip-btn clickable"
                  geometry="primitive: plane; width: 1.0; height: 1.3"
                  material="color: #4CC3D9"
                  animation__mouseenter="property: scale; to: 1.1 1.1 1.1; dur: 200"
                  animation__mouseleave="property: scale; to: 1 1 1; dur: 200">
          <a-text value="Trip 1" align="center" color="white" position="0 0 0.01" scale="2 2 2"></a-text>
        </a-entity>

        <a-entity position="-0.55 0 0" class="trip-btn clickable"
                  geometry="primitive: plane; width: 1.0; height: 1.3"
                  material="color: #7BC8A4"
                  animation__mouseenter="property: scale; to: 1.1 1.1 1.1; dur: 200"
                  animation__mouseleave="property: scale; to: 1 1 1; dur: 200">
          <a-text value="Trip 2" align="center" color="white" position="0 0 0.01" scale="2 2 2"></a-text>
        </a-entity>

        <a-entity position="0.55 0 0" class="trip-btn clickable"
                  geometry="primitive: plane; width: 1.0; height: 1.3"
                  material="color: #EF2D5E"
                  animation__mouseenter="property: scale; to: 1.1 1.1 1.1; dur: 200"
                  animation__mouseleave="property: scale; to: 1 1 1; dur: 200">
          <a-text value="Trip 3" align="center" color="white" position="0 0 0.01" scale="2 2 2"></a-text>
        </a-entity>

        <a-entity position="1.65 0 0" class="trip-btn clickable"
                  geometry="primitive: plane; width: 1.0; height: 1.3"
                  material="color: #FFC65D"
                  animation__mouseenter="property: scale; to: 1.1 1.1 1.1; dur: 200"
                  animation__mouseleave="property: scale; to: 1 1 1; dur: 200">
          <a-text value="Trip 4" align="center" color="white" position="0 0 0.01" scale="2 2 2"></a-text>
        </a-entity>

      </a-entity>

    </a-scene>
  </body>
</html>
